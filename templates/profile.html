{% extends "base.html" %}
{% block title %}Profile - AgriFarma{% endblock %}

{% block content %}
<style>
.page-gradient {
  background: linear-gradient(135deg, #e8f5e9 0%, #ffffff 40%, #e3f2fd 100%);
  min-height: 100vh;
  padding-bottom: 60px;
}

/* Glass card */
.glass-card {
  background: rgba(255,255,255,0.65);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(255,255,255,0.25);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.08);
  padding: 25px;
}

/* Profile Header */
.glass-header {
  background: linear-gradient(135deg, rgba(25,135,84,0.3), rgba(25,135,84,0.15));
  padding: 35px;
  border-radius: 20px;
}

.profile-avatar {
  width: 140px; height: 140px;
  border-radius: 50%;
  background: linear-gradient(135deg,#198754,#20c997);
  display:flex; align-items:center; justify-content:center;
  color:white; font-size:58px; font-weight:700;
  margin:auto; border:5px solid rgba(255,255,255,0.5);
  box-shadow:0 10px 25px rgba(25,135,84,0.35);
}

/* Stats */
.stat-box {
  text-align:center; padding:20px;
  border-radius:15px;
  background:rgba(25,135,84,0.05);
  border:1px solid rgba(25,135,84,0.15);
}
.stat-number { font-size:27px; font-weight:700; color:#198754; }
.stat-label { font-size:14px; color:#666; }

/* Info Section */
.info-title {
  font-size:18px; font-weight:700;
  color:#198754; margin-bottom:15px;
  display:flex; gap:8px; align-items:center;
}
.info-item {
  display:flex; justify-content:space-between;
  padding:12px 0;
  border-bottom:1px solid rgba(25,135,84,0.12);
}
.info-label { font-weight:600; color:#333; display:flex; gap:8px; align-items:center; }
.info-value { color:#555; }

/* Activity */
.activity-item {
  padding:15px; background:rgba(25,135,84,0.05);
  border-left:4px solid #198754;
  border-radius:8px; margin-bottom:10px;
}
.activity-time { font-size:12px; color:#999; }

/* Logout button placed in header right side */
.logout-btn {
  border-radius:30px; font-weight:600;
}

/* Edit Profile Modal Styling */
.modal-content {
  border: none;
  border-radius: 15px;
  overflow: hidden;
  box-shadow: 0 8px 32px rgba(0,0,0,0.15);
}

.modal-header {
  border-bottom: none;
  padding: 1.5rem;
  background: linear-gradient(135deg, rgba(25,135,84,0.3), rgba(25,135,84,0.15));
}

.modal-body {
  padding: 2rem;
  background: rgba(255,255,255,0.95);
  backdrop-filter: blur(8px);
}

.modal-footer {
  border-top: 1px solid rgba(25,135,84,0.1);
  padding: 1.5rem;
  background: rgba(255,255,255,0.95);
}

.form-control {
  border: 1px solid rgba(25,135,84,0.2);
  border-radius: 10px;
  padding: 0.75rem 1rem;
  transition: all 0.3s ease;
}

.form-control:focus {
  border-color: #198754;
  box-shadow: 0 0 0 0.2rem rgba(25, 135, 84, 0.25);
}

.form-label {
  font-weight: 600;
  color: #198754;
  margin-bottom: 0.5rem;
}
</style>

<div class="page-gradient py-5">
  <div class="container">

    <!-- ✅ Header with Logout and Edit -->
    <div class="glass-header mb-5">
      <div class="row align-items-center">
        
        <div class="col-md-3 text-center mb-3 mb-md-0">
          {% if user and user.picture %}
          <img src="{{ url_for('static', filename=user.picture) }}"
               class="profile-avatar img-fluid rounded-circle"
               style="width: 140px; height: 140px; object-fit: cover; border: 5px solid rgba(255,255,255,0.5);"
               alt="{{ user.name }}">
          {% else %}
          <div class="profile-avatar">
            {{ (user.name if user else session.get('user_name', 'U'))[0].upper() }}
          </div>
          {% endif %}
        </div>

        <div class="col-md-6 text-center text-md-start">
          <h2 class="fw-bold mb-1">{{ user.name if user else session.get('user_name', 'User Profile') }}</h2>
          <p class="text-muted mb-1">
            <span class="badge bg-success-subtle text-success px-3 py-2 rounded-pill">
              <i class="bi bi-shield-check me-1"></i>
              {{ user.role.capitalize() if user else session.get('user_role', 'member').capitalize() }}
            </span>
          </p>
          <p class="text-secondary mb-0"><i class="bi bi-calendar3 me-2"></i>Member since 2024</p>
        </div>

        <!-- ✅ Edit + Logout Buttons -->
        <div class="col-md-3 text-center text-md-end">
          <button class="btn btn-success me-2" data-bs-toggle="modal" data-bs-target="#editProfileModal">
            <i class="bi bi-pencil me-1"></i>Edit Profile
          </button>
          <a href="{{ url_for('auth.logout') }}" class="btn btn-outline-danger logout-btn">
            <i class="bi bi-box-arrow-right me-1"></i>Logout
          </a>
        </div>

      </div>
    </div>

    <!-- ✅ Stats Section - Perfectly aligned -->
    <div class="row g-4 mb-4">
      <div class="col-6 col-md-3"><div class="stat-box"><div class="stat-number">42</div><div class="stat-label">Forum Posts</div></div></div>
      <div class="col-6 col-md-3"><div class="stat-box"><div class="stat-number">18</div><div class="stat-label">Articles</div></div></div>
      <div class="col-6 col-md-3"><div class="stat-box"><div class="stat-number">156</div><div class="stat-label">Followers</div></div></div>
      <div class="col-6 col-md-3"><div class="stat-box"><div class="stat-number">89</div><div class="stat-label">Following</div></div></div>
    </div>

    <!-- ✅ 2 Equal Columns -->
    <div class="row g-4">

      <!-- LEFT COLUMN -->
      <div class="col-lg-6 d-flex flex-column gap-4">

        <!-- Personal Info -->
        <div class="glass-card h-100">
          <div class="info-title"><i class="bi bi-person"></i>Personal Information</div>
          <div class="info-item">
            <span class="info-label"><i class="bi bi-envelope"></i>Email</span>
            <span class="info-value">{{ user.email if user else session.get('user_email', 'N/A') }}</span>
          </div>
          <div class="info-item">
            <span class="info-label"><i class="bi bi-telephone"></i>Phone</span>
            <span class="info-value">{{ user.mobile if user and user.mobile else 'Not provided' }}</span>
          </div>
          <div class="info-item">
            <span class="info-label"><i class="bi bi-geo-alt"></i>Location</span>
            <span class="info-value">{{ user.location if user and user.location else 'Not provided' }}</span>
          </div>
          <div class="info-item">
            <span class="info-label"><i class="bi bi-briefcase"></i>Profession</span>
            <span class="info-value">{{ user.profession if user and user.profession else 'Not provided' }}</span>
          </div>
          <div class="info-item">
            <span class="info-label"><i class="bi bi-award"></i>Expertise</span>
            <span class="info-value">{{ user.expertise if user and user.expertise else 'Not provided' }}</span>
          </div>
        </div>

        <!-- Skills -->
        <div class="glass-card h-100">
          <div class="info-title"><i class="bi bi-lightning"></i>Skills & Expertise</div>
          <div class="d-flex flex-wrap gap-2">
            {% if user and user.expertise %}
              {% for skill in user.expertise.split(',') %}
                <span class="badge bg-success-subtle text-success">{{ skill.strip() }}</span>
              {% endfor %}
            {% else %}
              <span class="badge bg-success-subtle text-success">Crop Management</span>
              <span class="badge bg-success-subtle text-success">Soil Health</span>
              <span class="badge bg-success-subtle text-success">Irrigation</span>
              <span class="badge bg-success-subtle text-success">Organic Farming</span>
              <span class="badge bg-success-subtle text-success">Smart Farming</span>
            {% endif %}
          </div>
        </div>

      </div>

      <!-- RIGHT COLUMN -->
      <div class="col-lg-6">

        <!-- Activity -->
        <div class="glass-card h-100">
          <div class="info-title"><i class="bi bi-clock-history"></i>Recent Activity</div>

          <div class="activity-item">
            <strong>Posted in Forum</strong>
            <div class="activity-time">2 hours ago</div>
          </div>

          <div class="activity-item">
            <strong>Replied to a thread</strong>
            <div class="activity-time">5 hours ago</div>
          </div>

          <div class="activity-item">
            <strong>Updated profile</strong>
            <div class="activity-time">Yesterday</div>
          </div>

        </div>

      </div>

    </div>

    <!-- Edit Profile Modal -->
    <div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header bg-success text-white">
            <h5 class="modal-title" id="editProfileModalLabel">
              <i class="bi bi-pencil-square me-2"></i>Edit Profile
            </h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form method="POST" enctype="multipart/form-data" action="{{ url_for('edit_profile') }}">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="editName" class="form-label">Full Name</label>
                  <input type="text" class="form-control" id="editName" name="name"
                         value="{{ user.name if user else session.get('user_name', '') }}" required>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="editEmail" class="form-label">Email</label>
                  <input type="email" class="form-control" id="editEmail" name="email"
                         value="{{ user.email if user else session.get('user_email', '') }}" required>
                </div>
              </div>
              
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="editMobile" class="form-label">Phone</label>
                  <input type="text" class="form-control" id="editMobile" name="mobile"
                         value="{{ user.mobile if user and user.mobile else '' }}">
                </div>
                <div class="col-md-6 mb-3">
                  <label for="editLocation" class="form-label">Location</label>
                  <input type="text" class="form-control" id="editLocation" name="location"
                         value="{{ user.location if user and user.location else '' }}">
                </div>
              </div>
              
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="editProfession" class="form-label">Profession</label>
                  <input type="text" class="form-control" id="editProfession" name="profession"
                         value="{{ user.profession if user and user.profession else '' }}">
                </div>
                <div class="col-md-6 mb-3">
                  <label for="editExpertise" class="form-label">Expertise (comma-separated)</label>
                  <input type="text" class="form-control" id="editExpertise" name="expertise"
                         value="{{ user.expertise if user and user.expertise else '' }}"
                         placeholder="e.g., Crop Management, Soil Health">
                </div>
              </div>
              
              <div class="mb-3">
                <label for="editPicture" class="form-label">Profile Picture</label>
                <input type="file" class="form-control" id="editPicture" name="picture"
                       accept="image/*">
                <div class="form-text">Upload a new profile picture (JPG, PNG, GIF, WebP)</div>
              </div>
              
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                  <i class="bi bi-x-circle me-1"></i>Cancel
                </button>
                <button type="submit" class="btn btn-success">
                  <i class="bi bi-check-circle me-1"></i>Save Changes
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

{% endblock %}
