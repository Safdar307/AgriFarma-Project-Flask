{% extends "admin/dashboard_base.html" if False else "base.html" %}
{% block title %}Manage Products - Admin{% endblock %}
{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="mb-0">Products</h3>
    <div>
      <a href="{{ url_for('admin.create_product') }}" class="btn btn-success">Create Product</a>
      <a href="{{ url_for('admin.manage_categories') }}" class="btn btn-outline-secondary ms-2">Categories</a>
      <form method="post" action="{{ url_for('admin.cleanup_products') }}" class="d-inline ms-2">
        <button class="btn btn-outline-danger">Cleanup Old</button>
      </form>
    </div>
  </div>

  <form class="row g-2 mb-3" method="get">
    <div class="col-md-6">
      <input name="q" value="{{ q or '' }}" placeholder="Search products..." class="form-control">
    </div>
    <div class="col-md-2">
      <button class="btn btn-outline-primary w-100">Search</button>
    </div>
  </form>

  {% if products %}
  <div class="row g-3">
    {% for p in products %}
    <div class="col-12">
      <div class="card shadow-sm rounded-3">
        <div class="card-body d-flex gap-3 align-items-center">
          <div style="width:120px;height:90px;flex:0 0 120px;">
            {% if p.image %}
            <img src="{{ url_for('static', filename=p.image) }}" style="width:100%;height:100%;object-fit:cover;border-radius:6px;" alt="">
            {% else %}
            <div class="bg-light w-100 h-100 d-flex align-items-center justify-content-center">No image</div>
            {% endif %}
          </div>
          <div class="flex-grow-1">
            <h5 class="mb-1">{{ p.title }}</h5>
            <div class="text-muted small">{{ (p.description or '')[:160] }}{% if p.description and p.description|length > 160 %}...{% endif %}</div>
            <div class="mt-2">
              <strong class="text-success">${{ '%.2f'|format(p.price or 0) }}</strong>
              <span class="ms-3 badge {{ 'bg-success' if p.active else 'bg-secondary' }}">{{ 'Active' if p.active else 'Inactive' }}</span>
            </div>
          </div>
          <div class="text-end">
            <a href="{{ url_for('admin.edit_product', product_id=p.id) }}" class="btn btn-sm btn-outline-primary">Edit</a>
            <form method="post" action="{{ url_for('admin.delete_product', product_id=p.id) }}" class="d-inline ms-1" onsubmit="return confirm('Delete product?');">
              <button class="btn btn-sm btn-outline-danger">Delete</button>
            </form>
            <form method="post" action="{{ url_for('admin.toggle_product', product_id=p.id) }}" class="d-inline ms-1">
              <button class="btn btn-sm btn-outline-secondary">{{ 'Deactivate' if p.active else 'Activate' }}</button>
            </form>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="card p-4 text-center text-muted">No products yet.</div>
  {% endif %}

  {% if pagination %}
  <div class="d-flex justify-content-end mt-3">
    <nav>
      <ul class="pagination mb-0">
        <li class="page-item {{ 'disabled' if not pagination.has_prev else '' }}"><a class="page-link" href="{{ url_for('admin.manage_products', page=pagination.prev_num, q=q) }}">Prev</a></li>
        {% for p in range(1, pagination.pages + 1) %}
          <li class="page-item {{ 'active' if p == pagination.page else '' }}"><a class="page-link" href="{{ url_for('admin.manage_products', page=p, q=q) }}">{{ p }}</a></li>
        {% endfor %}
        <li class="page-item {{ 'disabled' if not pagination.has_next else '' }}"><a class="page-link" href="{{ url_for('admin.manage_products', page=pagination.next_num, q=q) }}">Next</a></li>
      </ul>
    </nav>
  </div>
  {% endif %}
</div>
{% endblock %}
